FROM golang:1.14.2-alpine3.11

ENV METRICS_DB_NAME "status-dev"
ENV METRICS_HOST "127.0.0.1"
ENV INTERVAL "2m"
ENV METRICS_PASSWORD "password"
ENV METRICS_PORT "5432"
ENV METRICS_SSL_MODE "true"
ENV METRICS_USERNAME "username"
ENV PORT "9019"

WORKDIR /agent
COPY . .

RUN apk update && apk add make
RUN make build

CMD ./target/pinger agent \
    --metrics-db-name=$METRICS_DB_NAME \
    --metrics-host=$METRICS_HOST \
    --interval=$METRICS_INTERVAL \
    --metrics-password=$METRICS_PASSWORD \
    --metrics-port=$METRICS_PORT \
    --metrics-ssl-mode=$METRICS_SSL_MODE \
    --metrics-username=$METRICS_USERNAME \
    --port=$PORT
